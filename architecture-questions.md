# Вопросы по архитектурному описанию с ответами

1. **Service worker и HTTPS.** Для работы сервис-воркера требуется защищённый контекст (HTTPS). На «обычном хостинге» у нас гарантировано наличие TLS-сертификата или нужно предусмотреть альтернативный офлайн-механизм для площадок без HTTPS?

**Ответ:** HTTPS у нас будет обеспечен.

2. **Структура информационной формы.** В `Audit.object_info` предлагается хранить JSON/текст, но не указано, какие поля должны быть обязательными и где лежит их схема. Нужно ли жёстко фиксировать структуру формы или разрешаем администраторам конфигурировать поля?

**Ответ:** Должна быть возможность конфигурирования вопросов - менять их расположение, форму, названия, категории и прочее. Необходимо учесть, что один аудит может содержать определенный набор полей, а после внесения администратором изменений новый аудит будет содержать другие поля. Это нормальное поведение системы.

3. **Импорт против ручного редактирования чек-листа.** Если администратор обновил вопросы через UI, а затем загрузил `data.csv`, какая операция считается источником истины? Требуется ли защита от перезаписи актуальных данных при повторном импорте?

**Ответ:** Импорт данных через CSV в этой версии не требуется. Эту функциональность можно отключить.

4. **Версионирование вопросов.** В модели есть `QuestionVersion`, но не описано, когда оно создаётся и как показывается в интерфейсе. Нужна ли эта сущность в первой версии или достаточно хранить историю через `AuditLogEntry`?

**Ответ:** История версий вопросов является избыточной функциональностью и не требуется для реализации.

5. **Ограничение доступа к аудиту.** Можно ли двум аудиторам одновременно редактировать один и тот же аудит (онлайн или офлайн)? Если да, как решаем конфликты при синхронизации? Если нет, нужна ли блокировка/назначение только одному исполнителю?

**Ответ:** Возможна ситуация, когда два аудитора проводят аудит разных лифтов и один из них по ошибке указывает тот же адрес. Блокировка не требуется - вся информация должна быть видна администратору. При этом администратор должен иметь возможность корректировать параметры аудита: время проведения, исполнителя, адрес. Сам аудит редактировать администратор не может.

6. **Лимиты на фото.** Для офлайн-хранилища и сервера не оговорены ограничения по размеру файла и форматам фотографий. Нужно ли автоматически сжимать изображения перед синхронизацией, чтобы уложиться в квоты обычного хостинга?

**Ответ:** Необходимо реализовать сжатие фотографий. Аудитор фотографирует на планшет или телефон. Желательно реализовать функцию: при нажатии на иконку рядом с вопросом сразу открывается камера устройства для мгновенного создания и сохранения фотографии. Ограничение - до 10 фотографий на вопрос.

7. **Переходы статусов аудита.** Список статусов задан, но не описаны правила переходов и роли (кто может переводить в `needs_revision` или `approved`). Требуется ли диаграмма состояний или достаточно базовой логики?

**Ответ:** Сложная система статусов не требуется. Процесс должен быть простым: аудитор проводит аудит и завершает его, администратор просматривает результаты и принимает административные решения. Единственное требование - администратор должен видеть в админке новые аудиты и уже просмотренные.

8. **Контроль количества комментариев/фото.** В `Audit` хранятся поля `comment_count` и `photo_count`. Они вычисляются динамически или сохраняются при каждой синхронизации? Нужно уточнить, чтобы избежать рассинхронизации данных.

**Ответ:** Данные должны обрабатываться динамически. Когда аудитор вписывает комментарий, информация сохраняется в базе данных и сразу становится доступной администратору.

9. **Обработка крупных пакетов синхронизации.** При отправке до 10 фото на каждый вопрос пакет может быть очень большим. Нужно ли реализовывать пофайловую синхронизацию или достаточно одной транзакции? Есть ли ограничения по времени отклика API?

**Ответ:** Фотографии должны загружаться поочередно, а не все одним пакетом. При возникновении ошибки загрузки аудитор должен получить уведомление с возможностью переснять фото или повторить попытку загрузки существующей фотографии.

10. **PDF-отчёты.** Планируется использовать `weasyprint`. Учитывая ограничения хостинга, уверены ли мы, что на выбранной площадке можно установить все зависимости (например, system packages для рендеринга PDF)?

**Ответ:** В данной версии генерация PDF-отчетов не требуется. Достаточно реализовать выгрузку отчетов в форматах Excel (XLSX, XLS) и CSV.
