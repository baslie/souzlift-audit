# Руководство разработчика

Документ описывает базовые процессы разработки проекта «Союзлифт Аудит». Информация дополняет архитектурное описание из [architecture.md](../architecture.md) и план задач в [AGENTS.md](../AGENTS.md).

## Окружение и инструменты

- **Язык и фреймворк:** Python 3.11, Django 5.x.
- **База данных:** SQLite (файл в каталоге `backend/`).
- **Фронтенд:** Django Templates, Tailwind CSS (предсобранный CSS-файл), точечное использование Alpine.js и HTMX.
- **Тестирование и качество кода:** `pytest`, `pytest-django`, `ruff`.
- **Управление зависимостями:** стандартный `pip` и `requirements.txt`.

### Настройка рабочего места

1. Склонируйте репозиторий и перейдите в директорию проекта.
2. Создайте виртуальное окружение: `python -m venv .venv`.
3. Активируйте окружение и обновите `pip` до актуальной версии.
4. Установите зависимости после появления `requirements.txt`: `pip install -r requirements.txt`.
5. Выполните миграции Django: `python manage.py migrate`.
6. Создайте суперпользователя: `python manage.py createsuperuser`.
7. Запустите локальный сервер: `python manage.py runserver`.

### Конфигурация окружения

- Конфигурация разделена на профили `dev` и `prod`. По умолчанию используется профиль разработки. Для переключения установите переменную окружения `DJANGO_ENV` в одно из значений: `dev`, `test`, `prod`.
- Секретный ключ задаётся переменной `DJANGO_SECRET_KEY`. В режиме разработки допускается значение по умолчанию, но для тестовых/боевых стендов необходимо указать собственный ключ.
- Список доменов и адресов, с которых разрешены запросы, задаётся через `DJANGO_ALLOWED_HOSTS` (перечисление через запятую). Для HTTPS-окружений дополнительно укажите `DJANGO_CSRF_TRUSTED_ORIGINS`.
- Почтовые параметры управляются переменными `DJANGO_EMAIL_HOST`, `DJANGO_EMAIL_PORT`, `DJANGO_EMAIL_HOST_USER`, `DJANGO_EMAIL_HOST_PASSWORD`, `DJANGO_EMAIL_USE_TLS`, `DJANGO_EMAIL_USE_SSL`, `DJANGO_DEFAULT_FROM_EMAIL`. В профиле `dev` используется консольный backend, поэтому сообщения выводятся в терминал.
- Для настройки логирования можно использовать `DJANGO_LOG_LEVEL` (уровень сообщений), `DJANGO_LOG_FILE` (путь до файла с логами в продакшене), `DJANGO_LOG_MAX_BYTES` и `DJANGO_LOG_BACKUP_COUNT` (параметры ротации).

Дополнительные инструкции по развёртыванию и обслуживанию будут добавляться в каталоге `docs/` по мере реализации этапов T9–T12.

## Стандарты разработки

### Ветвление

- Основная стабильная ветка — `main`.
- Для новых задач создавайте ветки вида `<stage>/<short-task-slug>` (например, `t1/setup-django`, `t3/catalog-models`).
- При работе над несколькими задачами параллельно допускается дополнительный префикс, отражающий направление, например `infra/t9-backups`.
- Перед созданием Pull Request выполняйте `git fetch --all` и `git rebase origin/main`.

### Коммиты и Pull Request

- Используйте стиль **Conventional Commits**.
- Включайте идентификатор задачи из `AGENTS.md` в начало описания коммита или в тело Pull Request (например, `feat: T1.1 bootstrap Django project`).
- Коммиты должны быть атомарными: один коммит — одна логически завершённая правка.
- Описание Pull Request содержит:
  - краткое резюме изменений;
  - ссылки на соответствующие разделы архитектуры, если архитектурные решения корректируются;
  - перечень запусков тестов и их результат.

### Код-ревью

- Минимум один апрув от технического руководителя или архитектора.
- Запрещено вливать код без прохождения автоматизированных проверок.
- Обсуждайте спорные архитектурные решения в Issues/документации прежде, чем вносить изменения.

## Тестирование

- Основные команды:
  - `pytest` — запуск всех тестов.
  - `ruff check backend/` — статический анализ Python-кода.
  - `python manage.py check` — встроенные проверки Django.
- Перед публикацией релиза обязательно выполняйте полный комплект тестов.
- При невозможности запуска тестов фиксируйте причину и указывайте её в отчёте и Pull Request.

## Работа с данными и медиа

- Файлы БД и медиа размещаются в каталоге `backend/` (подкаталоги `db/`, `media/` будут добавлены на соответствующих этапах).
- Доступ к медиа-файлам ограничивается через авторизованные контроллеры; на разработке медиа могут обслуживаться напрямую.
- Резервное копирование SQLite и каталога медиа реализуется скриптами из `scripts/` (этапы T9.x, T12.x).

## Документация

- Любые архитектурные или процессные изменения отражайте в `architecture.md` и `AGENTS.md`.
- Для пользовательских инструкций (аудиторы, администраторы) будет создан раздел в `docs/` на этапе T11.3.
- Дополнительные руководства (например, по офлайн-синхронизации) оформляйте в отдельных файлах внутри `docs/` с понятными именами.
- Релизные и эксплуатационные процедуры описаны в [operations.md](operations.md); поддерживайте документ в актуальном состоянии.

## Контакты

Вопросы по архитектуре и процессам направляйте техническому руководителю проекта. Каналы коммуникации будут зафиксированы отдельно после утверждения организационной структуры.
