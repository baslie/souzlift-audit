# Руководство пользователей «Союзлифт Аудит»

Документ описывает сценарии работы аудиторов и администраторов с веб-приложением «Союзлифт Аудит». Материал дополняет архитектурные положения [§1](../architecture/v1.md#1-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%BA%D1%81%D1%82-%D0%B8-%D1%86%D0%B5%D0%BB%D0%B8), [§7.2](../architecture/v1.md#72-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0-%D0%B0%D1%83%D0%B4%D0%B8%D1%82%D0%BE%D1%80%D0%B0) и [§7.3](../architecture/v1.md#73-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0-%D0%B0%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%B0), а также связан с требованиями офлайн-работы из [§6](../architecture/v1.md#6-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F).

> **Важно.** Интерфейс рассчитан на запуск через современный браузер с поддержкой сервис-воркеров (Chrome, Edge, Firefox, мобильные версии на Android). Для корректной офлайн-работы используйте HTTPS-домен и не очищайте вручную кэш сайта до завершения синхронизации данных.

## 1. Доступ и базовые требования

- Доступ к системе осуществляется по именной учётной записи. Первичный пароль выдаёт администратор; при первом входе система требует его сменить (см. [§7.1](../architecture/v1.md#71-%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F-%D0%B8-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F%D0%BC%D0%B8)).
- После успешного входа система сохраняет сессию, что позволяет продолжить работу офлайн без повторной авторизации, пока пользователь не выполнит явный выход.
- Каталоги зданий, лифтов и шаблонов чек-листа загружаются при наличии сети и кэшируются для офлайн-доступа (см. [§5.2](../architecture/v1.md#52-%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA-%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82%D0%BE%D0%B2-%D0%B8-%D0%BB%D0%B8%D1%84%D1%82%D0%BE%D0%B2) и [§5.3](../architecture/v1.md#53-%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA-%D1%87%D0%B5%D0%BA-%D0%BB%D0%B8%D1%81%D1%82%D0%B0)).
- Максимальный размер одного вложения — 8 МБ; допускается до 10 фотографий на вопрос и не более 100 фото на аудит (см. [§5.4](../architecture/v1.md#54-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B0%D1%83%D0%B4%D0%B8%D1%82%D0%B0)).

## 2. Работа аудитора

### 2.1. Подготовка перед выездом

1. Подключитесь к сети, выполните вход и перейдите в раздел «Мои аудиты». Это гарантирует обновление справочников и шаблонов перед офлайн-работой (см. [§6](../architecture/v1.md#6-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).
2. Убедитесь, что индикатор синхронизации не показывает необработанных ошибок. При наличии проблем откройте список и повторите отправку до выезда.
3. При необходимости обновите контакты и дополнительную информацию о себе в профиле.

### 2.2. Создание аудита

1. На странице «Мои аудиты» нажмите «Создать аудит».
2. Выберите здание и лифт из справочника. Если нужного объекта нет, добавьте карточку через форму «Новое здание»/«Новый лифт» — записи будут помечены статусом `pending` до подтверждения администратором (см. [§5.2](../architecture/v1.md#52-%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA-%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82%D0%BE%D0%B2-%D0%B8-%D0%BB%D0%B8%D1%84%D1%82%D0%BE%D0%B2)).
3. Заполните информационную карту объекта: система отображает обязательные поля и подсказки из конфигурации `ObjectInfoField` (см. [§5.3](../architecture/v1.md#53-%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA-%D1%87%D0%B5%D0%BA-%D0%BB%D0%B8%D1%81%D1%82%D0%B0)).
4. После сохранения аудит получает статус `draft` и становится доступен в офлайн-режиме.

### 2.3. Заполнение чек-листа

1. При переходе в аудит статус меняется на `in_progress`; ответы сохраняются автоматически.
2. Для каждого вопроса выберите балл согласно доступным опциям `ScoreOption`. Если балл ниже максимального, комментарий становится обязательным.
3. При необходимости прикрепите фотографии: до 10 на вопрос, автоматически сжимаются перед сохранением (см. [§5.4](../architecture/v1.md#54-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B0%D1%83%D0%B4%D0%B8%D1%82%D0%B0)).
4. Система отображает подсказки и требования к комментариям, а также предупреждает о превышении лимитов.

### 2.4. Работа офлайн

- Интерфейс и справочники кэшируются сервис-воркером; при потере сети вы можете продолжить редактирование черновика или создавать новые аудиты на основе кэшированных данных (см. [§6.1](../architecture/v1.md#6-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).
- Ответы, комментарии и фотографии сохраняются в локальные хранилища `offline_responses` и `offline_attachments`; новые объекты справочника попадают в очередь `offline_catalog_additions` (см. [§6.2](../architecture/v1.md#6-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).
- Если устройство закрывает вкладку, данные остаются в кэше и будут восстановлены при следующем входе.

### 2.5. Завершение и синхронизация

1. После заполнения всех секций нажмите «Отправить аудит». Статус изменится на `submitted`, а данные попадут в очередь синхронизации.
2. При появлении сети синхронизация запускается автоматически. Для ручного запуска используйте кнопку «Отправить данные» в блоке уведомлений (см. [§6.5](../architecture/v1.md#6-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).
3. При успешной отправке вы увидите подтверждение с итоговыми баллами; локальный кэш аудита очищается, чтобы освободить память устройства (см. [§6.5](../architecture/v1.md#6-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).
4. Если сервер отклоняет пакет (конфликт, превышение размера файла), система показывает список проблемных вопросов. Скорректируйте данные и повторите отправку — вложения можно переснять или удалить (см. [§6.4](../architecture/v1.md#6-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).
5. Для продолжения работы на другом устройстве войдите под своей учётной записью и загрузите аудит из сервера — локальный кэш восстановится после синхронизации (см. [§6.6](../architecture/v1.md#6-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).

### 2.6. Чек-лист аудитора

- [ ] Перед выездом выполнен вход и обновлены справочники.
- [ ] В очереди синхронизации нет необработанных ошибок.
- [ ] Заряд устройства и объём памяти достаточны для фотофиксации.
- [ ] После завершения аудита подтверждена успешная отправка данных.
- [ ] При работе на нескольких устройствах проверено, что последний аудит синхронизирован.

## 3. Работа администратора

### 3.1. Управление справочниками

- Создавайте и редактируйте здания и лифты через административный интерфейс. Записи, созданные аудиторами, отображаются со статусом `pending`; проверьте корректность данных и установите `approved` или `rejected` (см. [§5.2](../architecture/v1.md#52-%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA-%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82%D0%BE%D0%B2-%D0%B8-%D0%BB%D0%B8%D1%84%D1%82%D0%BE%D0%B2) и [§7.3](../architecture/v1.md#73-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0-%D0%B0%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%B0)).
- Регулярно проверяйте очередь неподтверждённых объектов, чтобы аудиторы могли использовать их в новых проверках.

### 3.2. Конструктор чек-листа

- Управляйте категориями, секциями и вопросами через Django Admin, соблюдая порядок `order` и требования к обязательности комментариев (см. [§5.3](../architecture/v1.md#53-%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA-%D1%87%D0%B5%D0%BA-%D0%BB%D0%B8%D1%81%D1%82%D0%B0)).
- Избегайте удаления вопросов, используемых в активных аудитах; при изменениях корректируйте описания и максимальные баллы.

### 3.3. Управление пользователями

- Создавайте учётные записи аудиторов с временным паролем и ролью `AUDITOR`; активируйте их только после подтверждения личности сотрудника (см. [§7.1](../architecture/v1.md#71-%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F-%D0%B8-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F%D0%BC%D0%B8)).
- При необходимости сбрасывайте пароли и блокируйте доступ временно неактивных аудиторов.

### 3.4. Обработка аудитов

- Просматривайте завершённые аудиты (`submitted`) в административном разделе. После проверки материалов установите статус `reviewed` и зафиксируйте решения в журналах (см. [§5.4](../architecture/v1.md#54-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B0%D1%83%D0%B4%D0%B8%D1%82%D0%B0) и [§8](../architecture/v1.md#8-%D0%B0%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%B8-%D0%BE%D1%82%D1%87%D1%91%D1%82%D1%8B)).
- Проверяйте вложения и комментарии: лимиты сохраняются на уровне сервера, но возможно появление дублей или некачественных фото — при необходимости запросите повторную проверку, создав новый аудит.

### 3.5. Контроль синхронизации

- Мониторьте ошибки офлайн-синхронизации через административные отчёты и журналы `OfflineSyncBatch`. Статусы `error` требуют обратной связи с аудитором и повторной попытки синхронизации (см. [§6.3](../architecture/v1.md#6-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F) и [§9](../architecture/v1.md#9-%D0%B1%D0%B8%D0%B7%D0%BD%D0%B5%D1%81-%D0%BB%D0%BE%D0%B3%D0%B8%D0%BA%D0%B0-%D0%B8-%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D0%B0)).
- При повторяющихся сбоях проверьте состояние сервера и наличие свободного места (см. процедуры [docs/runbooks/operations.md](../runbooks/operations.md)).

### 3.6. Чек-лист администратора

- [ ] Проверены новые здания и лифты, созданные аудиторами.
- [ ] Актуализирован чек-лист и подтверждена корректность обязательных полей.
- [ ] Обработаны запросы на создание/блокировку учётных записей.
- [ ] Завершённые аудиты просмотрены и помечены статусом `reviewed`.
- [ ] Журналы синхронизации не содержат необработанных ошибок.

## 4. Частые вопросы и рекомендации

| Ситуация | Действия |
|----------|----------|
| Фото не загружается из-за превышения размера | Сделайте новую фотографию с меньшим разрешением или используйте встроенное сжатие перед повторной отправкой (см. лимиты [§5.4](../architecture/v1.md#54-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B0%D1%83%D0%B4%D0%B8%D1%82%D0%B0)). |
| В аудите пропал доступ к зданию/лифту | Проверьте статус записи (`pending` может быть отклонён администратором). При необходимости уточните решение у администратора. |
| Данные не синхронизируются после возвращения в сеть | Проверьте список ошибок, удалите или скорректируйте проблемные ответы и повторите отправку вручную (см. [§6.4](../architecture/v1.md#6-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)). |
| Необходим перенос работы на другое устройство | Завершите синхронизацию на текущем устройстве, выполните вход на новом и загрузите аудит из списка «Мои аудиты» (см. [§6.6](../architecture/v1.md#6-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)). |

Документ обновляется при изменении пользовательских сценариев или архитектурных решений.
