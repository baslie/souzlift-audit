# Руководство пользователей «Союзлифт Аудит»

Документ описывает сценарии работы аудиторов, прикладных администраторов и технического оператора с веб-приложением «Союзлифт Аудит». Материал дополняет архитектурные положения [§1](../architecture/v2.md#1-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%BA%D1%81%D1%82-%D0%B8-%D1%86%D0%B5%D0%BB%D0%B8), [§2](../architecture/v2.md#2-%D1%80%D0%BE%D0%BB%D0%B8-%D0%B8-%D0%BE%D1%82%D0%B2%D0%B5%D1%82%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D1%8C), [§5.1–§5.4](../architecture/v2.md#51-%D0%BE%D0%BD%D0%B1%D0%BE%D1%80%D0%B4%D0%B8%D0%BD%D0%B3-%D0%B0%D0%BA%D0%BA%D0%B0%D1%83%D0%BD%D1%82%D0%BE%D0%B2) и требования офлайн-режима из [§8](../architecture/v2.md#8-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F).

> **Важно.** Интерфейс рассчитан на запуск через современный браузер с поддержкой сервис-воркеров (Chrome, Edge, Firefox, мобильные версии на Android). Для корректной офлайн-работы используйте HTTPS-домен и не очищайте вручную кэш сайта до завершения синхронизации данных.

## 1. Доступ, роли и базовые требования

- Учётные записи создаёт технический оператор (суперпользователь Django) через `/admin`, присваивая роль `ADMIN` или `AUDITOR`. Первичный пароль передаётся безопасным каналом и должен быть сменён при первом входе (см. [§5.1](../architecture/v2.md#51-%D0%BE%D0%BD%D0%B1%D0%BE%D1%80%D0%B4%D0%B8%D0%BD%D0%B3-%D0%B0%D0%BA%D0%BA%D0%B0%D1%83%D0%BD%D1%82%D0%BE%D0%B2)).
- После успешного входа сессия сохраняется, позволяя продолжить работу офлайн без повторной авторизации, пока пользователь не выполнит явный выход.
- Каталоги зданий, лифтов, структура чек-листа и вспомогательные справочники загружаются при наличии сети и кэшируются для офлайн-доступа (см. [§5.2](../architecture/v2.md#52-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA%D0%B0%D0%BC%D0%B8) и [§5.3](../architecture/v2.md#53-%D0%BA%D0%BE%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D1%87%D0%B5%D0%BA-%D0%BB%D0%B8%D1%81%D1%82%D0%B0-%D0%BD%D0%BE%D0%B2%D1%8B%D0%B9-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB)).
- Максимальный размер одного вложения — 8 МБ; допускается до 10 фотографий на вопрос и не более 100 файлов на аудит (см. [§5.4](../architecture/v2.md#54-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8-%D0%BA%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D1%8C-%D0%B0%D1%83%D0%B4%D0%B8%D1%82%D0%BE%D0%B2)).
- При смене устройства убедитесь, что завершена синхронизация на предыдущем — кэш переносится автоматически после авторизации (см. [§8.3](../architecture/v2.md#8-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).

## 2. Работа аудитора

### 2.1. Подготовка перед выездом

1. Подключитесь к сети, выполните вход и перейдите в раздел «Мои аудиты». Это гарантирует обновление справочников и шаблонов перед офлайн-работой (см. [§8](../architecture/v2.md#8-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).
2. Убедитесь, что индикатор синхронизации не показывает необработанных ошибок. При наличии проблем откройте список и повторите отправку до выезда.
3. При необходимости обновите контакты и дополнительную информацию о себе в профиле.

### 2.2. Создание аудита

1. На странице «Мои аудиты» нажмите «Создать аудит».
2. Выберите здание и лифт из справочника. Если нужного объекта нет, добавьте карточку через форму «Новое здание»/«Новый лифт» — записи будут помечены статусом `pending` до подтверждения администратором (см. [§5.2](../architecture/v2.md#52-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA%D0%B0%D0%BC%D0%B8)).
3. Заполните информационную карту объекта: система отображает обязательные поля и подсказки из конфигурации `ObjectInfoField` (см. [§5.3](../architecture/v2.md#53-%D0%BA%D0%BE%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D1%87%D0%B5%D0%BA-%D0%BB%D0%B8%D1%81%D1%82%D0%B0-%D0%BD%D0%BE%D0%B2%D1%8B%D0%B9-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB)).
4. После сохранения аудит получает статус `draft` и становится доступен в офлайн-режиме.

### 2.3. Заполнение чек-листа

1. При переходе в аудит статус меняется на `in_progress`; ответы сохраняются автоматически.
2. Для каждого вопроса выберите балл согласно доступным опциям `ScoreOption`. Если балл ниже максимального, комментарий становится обязательным.
3. При необходимости прикрепите фотографии: до 10 на вопрос, файлы автоматически сжимаются перед сохранением (см. [§5.4](../architecture/v2.md#54-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8-%D0%BA%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D1%8C-%D0%B0%D1%83%D0%B4%D0%B8%D1%82%D0%BE%D0%B2)).
4. Система отображает подсказки и требования к комментариям, а также предупреждает о превышении лимитов.

### 2.4. Работа офлайн

- Интерфейс и справочники кэшируются сервис-воркером; при потере сети вы можете продолжить редактирование черновика или создавать новые аудиты на основе кэшированных данных (см. [§8.1](../architecture/v2.md#8-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).
- Ответы, комментарии и фотографии сохраняются в локальные хранилища `offline_responses` и `offline_attachments`; новые объекты справочника попадают в очередь `offline_catalog_additions` (см. [§8.1](../architecture/v2.md#8-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).
- Если устройство закрывает вкладку, данные остаются в кэше и будут восстановлены при следующем входе.

### 2.5. Завершение и синхронизация

1. После заполнения всех секций нажмите «Отправить аудит». Статус изменится на `submitted`, а данные попадут в очередь синхронизации.
2. При появлении сети синхронизация запускается автоматически. Для ручного запуска используйте кнопку «Отправить данные» в блоке уведомлений (см. [§8.2](../architecture/v2.md#8-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).
3. При успешной отправке вы увидите подтверждение с итоговыми баллами; локальный кэш аудита очищается, чтобы освободить память устройства.
4. Если сервер отклоняет пакет (конфликт, превышение размера файла), система показывает список проблемных вопросов. Скорректируйте данные и повторите отправку — вложения можно переснять или удалить (см. [§8.2](../architecture/v2.md#8-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).
5. Для продолжения работы на другом устройстве войдите под своей учётной записью и загрузите аудит из сервера — локальный кэш восстановится после синхронизации (см. [§8.3](../architecture/v2.md#8-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).

### 2.6. Чек-лист аудитора

- [ ] Перед выездом выполнен вход и обновлены справочники.
- [ ] В очереди синхронизации нет необработанных ошибок.
- [ ] Заряд устройства и объём памяти достаточны для фотофиксации.
- [ ] После завершения аудита подтверждена успешная отправка данных.
- [ ] При работе на нескольких устройствах проверено, что последний аудит синхронизирован.

## 3. Работа администратора (роль `ADMIN`)

### 3.1. Панель «Справочники»

- Управляйте зданиями и лифтами в кабинете администратора (`/app/catalog/`). Очередь «Ожидают утверждения» показывает записи со статусом `pending`, созданные аудиторами. После проверки установите статус `approved` или `rejected` и добавьте комментарий (см. [§5.2](../architecture/v2.md#52-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA%D0%B0%D0%BC%D0%B8)).
- Используйте фильтры по статусу, объекту и автору, чтобы ускорить модерацию. Система подсвечивает заявки старше трёх рабочих дней.

### 3.2. Раздел «Чек-лист»

- Создавайте и редактируйте категории, секции, вопросы и варианты баллов через `/app/checklist/`. Порядок элементов обновляется кнопками перемещения; изменения вступают в силу сразу (см. [§5.3](../architecture/v2.md#53-%D0%BA%D0%BE%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D1%87%D0%B5%D0%BA-%D0%BB%D0%B8%D1%81%D1%82%D0%B0-%D0%BD%D0%BE%D0%B2%D1%8B%D0%B9-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB)).
- Перед сохранением проверяйте обязательность комментариев и корректность максимальных баллов. Предпросмотр структуры использует тот же сериализатор, что и офлайн-снапшоты.

### 3.3. Управление доступом

- При необходимости новых аккаунтов или смены ролей отправьте заявку техническому оператору. Только суперпользователь может создавать профили, присваивать роли и восстанавливать пароли через `/admin` (см. [§2](../architecture/v2.md#2-%D1%80%D0%BE%D0%BB%D0%B8-%D0%B8-%D0%BE%D1%82%D0%B2%D0%B5%D1%82%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D1%8C)).
- Актуализируйте контактную информацию в профилях пользователей и уведомляйте аудиторов о политике безопасности.

### 3.4. Контроль аудитов

- Используйте расширенный список аудитов (`/app/audits/`) для фильтрации по статусу, автору и периоду. После проверки материалов отметьте запись как «просмотрено» — автор получит уведомление (см. [§5.4](../architecture/v2.md#54-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8-%D0%BA%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D1%8C-%D0%B0%D1%83%D0%B4%D0%B8%D1%82%D0%BE%D0%B2)).
- При необходимости экспортируйте результаты без перехода в Django Admin: доступны варианты печати и выгрузки CSV/Excel.

### 3.5. Мониторинг синхронизации

- Проверяйте журнал `OfflineSyncBatch` в разделе «Мониторинг» кабинета. Статусы `error` требуют обратной связи с аудитором и повторной попытки синхронизации (см. [§8](../architecture/v2.md#8-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)).
- При повторяющихся сбоях проверьте состояние сервера и наличие свободного места; инструкции приведены в [docs/runbooks/operations.md](../runbooks/operations.md).

### 3.6. Чек-лист администратора

- [ ] Проверены и утверждены новые здания/лифты, созданные аудиторами.
- [ ] Изменения чек-листа опубликованы и проверены в предпросмотре.
- [ ] Уточнены запросы на создание или блокировку аккаунтов у технического оператора.
- [ ] Завершённые аудиты просмотрены, при необходимости выгружены отчёты.
- [ ] Журнал офлайн-синхронизации не содержит статусов `error` старше 24 часов.

## 4. Работа технического оператора (суперпользователь Django)

- Создавайте и сопровождайте учётные записи через `/admin`, ограничиваясь служебными моделями (пользователи, профили). Все бизнес-справочники обслуживаются прикладными администраторами (см. [§6.1](../architecture/v2.md#61-django-admin)).
- Обеспечивайте резервное копирование и мониторинг согласно [docs/runbooks/operations.md](../runbooks/operations.md), включая контроль логов офлайн-синхронизации.
- Проводите обучение новых администраторов с демонстрацией разделов кабинета; фиксируйте прохождение онбординга в журнале поддержки (см. [§5.1](../architecture/v2.md#51-%D0%BE%D0%BD%D0%B1%D0%BE%D1%80%D0%B4%D0%B8%D0%BD%D0%B3-%D0%B0%D0%BA%D0%BA%D0%B0%D1%83%D0%BD%D1%82%D0%BE%D0%B2)).

## 5. Частые вопросы и рекомендации

| Ситуация | Действия |
|----------|----------|
| Фото не загружается из-за превышения размера | Сделайте новую фотографию с меньшим разрешением или используйте встроенное сжатие перед повторной отправкой (см. лимиты [§5.4](../architecture/v2.md#54-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8-%D0%BA%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D1%8C-%D0%B0%D1%83%D0%B4%D0%B8%D1%82%D0%BE%D0%B2)). |
| В аудите пропал доступ к зданию/лифту | Проверьте статус записи (`pending` может быть отклонён администратором). При необходимости уточните решение у администратора. |
| Данные не синхронизируются после возвращения в сеть | Проверьте список ошибок, удалите или скорректируйте проблемные ответы и повторите отправку вручную (см. [§8.2](../architecture/v2.md#8-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)). |
| Необходим перенос работы на другое устройство | Завершите синхронизацию на текущем устройстве, выполните вход на новом и загрузите аудит из списка «Мои аудиты» (см. [§8.3](../architecture/v2.md#8-%D0%BE%D1%84%D0%BB%D0%B0%D0%B9%D0%BD-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC-%D0%B8-%D1%81%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)). |

Документ обновляется при изменении пользовательских сценариев или архитектурных решений.
