{% extends "base.html" %}
{% block title %}{{ template.name }} · Чек-листы · Союзлифт Аудит{% endblock %}
{% block heading %}{{ template.name }}{% endblock %}
{% block subheading %}
  <p class="text-sm text-ink-500">{{ template.description|default:"Описание не задано" }}</p>
{% endblock %}
{% block actions %}
  <a href="{% url 'checklists:template-list' %}" class="btn btn--secondary text-xs">К списку</a>
{% endblock %}
{% block content %}
  <div class="space-y-4">
    <section class="rounded-xl border border-border bg-white p-5 shadow-sm">
      <dl class="grid gap-4 text-sm text-ink-700 sm:grid-cols-2 lg:grid-cols-4">
        <div>
          <dt class="text-xs uppercase tracking-wide text-ink-500">Опубликован</dt>
          <dd>
            {% if template.published_at %}
              {{ template.published_at|date:"d.m.Y" }}
            {% else %}
              <span class="text-ink-400">Не опубликован</span>
            {% endif %}
          </dd>
        </div>
        <div>
          <dt class="text-xs uppercase tracking-wide text-ink-500">Активен</dt>
          <dd>{% if template.is_active %}Да{% else %}Нет{% endif %}</dd>
        </div>
        <div>
          <dt class="text-xs uppercase tracking-wide text-ink-500">Создан</dt>
          <dd>{{ template.created_at|date:"d.m.Y H:i" }}</dd>
        </div>
        <div>
          <dt class="text-xs uppercase tracking-wide text-ink-500">Обновлён</dt>
          <dd>{{ template.updated_at|date:"d.m.Y H:i" }}</dd>
        </div>
      </dl>
    </section>

    <section class="space-y-3">
      <h2 class="text-lg font-semibold text-ink-900">Пункты чек-листа</h2>
      <ol class="space-y-3">
        {% for item in items %}
          <li class="rounded-xl border border-border-subtle bg-white p-4 shadow-sm">
            <header class="flex flex-wrap items-center justify-between gap-2">
              <span class="text-xs font-semibold uppercase tracking-wide text-brand-600">Пункт №{{ forloop.counter }}</span>
              <span class="rounded-full border border-border px-3 py-1 text-xs text-ink-500">{{ item.get_score_type_display }}</span>
            </header>
            <p class="mt-2 text-sm font-medium text-ink-900">{{ item.question }}</p>
            {% if item.help_text %}
              <p class="mt-1 text-xs text-ink-500">{{ item.help_text }}</p>
            {% endif %}
            <dl class="mt-3 grid gap-4 text-xs text-ink-500 md:grid-cols-3">
              <div>
                <dt class="uppercase tracking-wide">Зона</dt>
                <dd>{{ item.area|default:"—" }}</dd>
              </div>
              <div>
                <dt class="uppercase tracking-wide">Категория</dt>
                <dd>{{ item.category|default:"—" }}</dd>
              </div>
              <div>
                <dt class="uppercase tracking-wide">Вес</dt>
                <dd>{{ item.weight }}</dd>
              </div>
            </dl>
            <div class="mt-3 text-xs text-ink-500">
              {% if item.score_type == 'numeric' %}
                Диапазон: {{ item.min_score }} – {{ item.max_score }}, шаг {{ item.step }}
              {% else %}
                Варианты: {{ item.normalized_options|join:", " }}
              {% endif %}
            </div>
            {% if item.requires_comment %}
              <div class="mt-2 inline-flex items-center rounded-full bg-warning-100 px-3 py-1 text-xs font-semibold text-warning-700">
                Комментарий обязателен
              </div>
            {% endif %}
          </li>
        {% empty %}
          <li class="rounded-xl border border-dashed border-border bg-surface-subtle px-4 py-6 text-sm text-ink-500">
            Пункты чек-листа отсутствуют.
          </li>
        {% endfor %}
      </ol>
    </section>
  </div>
{% endblock %}
